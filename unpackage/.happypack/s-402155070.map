{"version":3,"sources":["src\\common\\contractUtils.js"],"names":[],"mappings":"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","file":"contractUtils.js","sourceRoot":"C:/Users/dell/AppData/Roaming/HBuilder/userprofiles/18710095921@163.com/jxddH5PlusApp/unpackage","sourcesContent":["'use strict';\r\n/**\r\n * @file 此js文件用于处理合同相关的公共方法\r\n * @Author liyubai\r\n * 使用方法：import contractUtils from 'common/contractUtils'\r\n */\r\n\r\nimport muiUtils from './muiUtils';\r\nimport api from 'api';\r\nimport CONSTS from 'common/consts';\r\n\r\n/**\r\n * @desc 设置合同的优惠或减免\r\n * @param {id} 合同ID\r\n * @param {sn} 合同编号\r\n * @param {type} 设置类型 设置优惠（youhui）、减免（jianmian）\r\n * @param {callback} 回调函数\r\n * @public\r\n */\r\nconst setContractPrice = (id, sn, type, callback, unpayamount, pay_state) => {\r\n    var btnArray = ['取消', '提交'];\r\n    var alertTitle = '';\r\n    var alertInfo = '';\r\n    var typeNum = 3;\r\n    if (type === 'discount') {\n        alertTitle = '设置优惠';\r\n        alertInfo = '请输入优惠金额';\r\n        typeNum = 4;\r\n    } else if (type === 'relief') {\n        alertTitle = '设置减免';\r\n        alertInfo = '请输入减免金额';\r\n        typeNum = 3;\r\n    }\r\n    mui.prompt(alertInfo, '0.00', alertTitle, btnArray, function(e) {\r\n        if (e.index === 1) {\r\n            if (!isNaN(e.value)) {\r\n                var money = Number(e.value);\r\n                if (money <= 0) {\r\n                    mui.toast('金额必须大于0元');\r\n                } else if (money > unpayamount) {\r\n                    mui.toast('金额必须小于未付金额');\r\n                } else {\r\n                    var params = {\r\n                        store_id: muiUtils.getLoginUserInfo().store_id,\r\n                        type: typeNum,\r\n                        member_id: muiUtils.getLoginUserInfo().user_id,\r\n                        contract: {\r\n                            order_id: id,\r\n                            order_sn: sn,\r\n                            amount: e.value,\r\n                            pay_state: pay_state\r\n                        }\r\n                    };\r\n                    var api_url = api.CONTRACT_API.contract_relief_discount;\r\n                    muiUtils.muiAjax(api_url, {\r\n                        type: 'post',\r\n                        data: JSON.stringify(params),\r\n                        contentType: 'application/json',\r\n                        dataType: 'json',\r\n                        success: function(data) {\r\n                            if (data.header.code === CONSTS.ERROR_CODE.SUCCESS) {\r\n                                mui.toast(alertTitle + '成功');\r\n                            }\r\n                            else {\r\n                                mui.toast(data.msg);\r\n                            }\r\n                            if (callback) {\r\n                                callback(data.header.code);\r\n                            }\r\n                        },\r\n                        error: function(xhr, type, errorThrown) {\r\n                            mui.toast('提交合同失败，稍后重试！');\r\n                        }\r\n                    });\r\n                }\r\n            } else {\r\n                mui.toast('请输入数字');\r\n            }\r\n        } else {\r\n            // mui.toast('取消');\r\n        }\r\n    }, 'div');\r\n    document.querySelector('.mui-popup-input input').type = 'number';\r\n};\r\n\r\n/**\r\n * 查看合同物流\r\n */\r\nconst lookContractLogistics = (contractInfo) => {\r\n    muiUtils.openWindow('../../commonpage/contract/logistics.html', 'commonpage_contract_logistics.html', {\r\n        extras: {\r\n            'contractInfo': contractInfo\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 跳转合同评价页面\r\n */\r\nconst evaluateContract = (contractInfo) => {\r\n    muiUtils.openWindow('../../buyer/contract/contractevaluate.html', 'buyer_contract_contractevaluate.html', {\r\n        extras: {\r\n            'contractInfo': contractInfo\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 跳转合同支付页面\r\n */\r\nconst payContract = (contractInfo) => {\r\n    var contract_ids = [contractInfo.contract_id];\r\n    muiUtils.openWindow('../../buyer/contract/selectpaytype.html', 'buyer_contract_selectpaytype.html', {\r\n        extras: {\r\n            payInfo: {\r\n                'contract_id': contract_ids,\r\n                'sum_amount': Number(contractInfo.unpay_amount).toFixed(2)\r\n            }\r\n        },\r\n        styles: {\r\n            popGesture: 'none'\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 取消合同\r\n */\r\nconst cancelContract = (contractInfo, callback) => {\r\n    var btnArray = ['取消', '确定'];\r\n    mui.confirm('订单编号：' + contractInfo.contract_id, '您是否要取消订单', btnArray, function(e) {\r\n        if (e.index == 1) {\r\n            var params = {\r\n                store_id: '',\r\n                contract_id: contractInfo.contract_id,\r\n                member_id: muiUtils.getLoginUserInfo().user_id\r\n            };\r\n            var api_url = api.CONTRACT_API.contract_cancel;\r\n            muiUtils.muiAjax(api_url, {\r\n                type: 'post',\r\n                data: JSON.stringify(params),\r\n                contentType: 'application/json',\r\n                dataType: 'json',\r\n                success: function(data) {\r\n                    if (data.header.code === CONSTS.ERROR_CODE.SUCCESS) {\r\n                        mui.toast('合同取消成功');\r\n                    }\r\n                    else {\r\n                        mui.toast(data.msg);\r\n                    }\r\n                    if (callback) {\r\n                        callback(data.header.code);\r\n                    }\r\n                },\r\n                error: function(xhr, type, errorThrown) {\r\n                    mui.toast('提交合同失败，稍后重试！');\r\n                }\r\n            });\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 合同发货\r\n */\r\nconst deliverContract = (contractInfo) => {\r\n    muiUtils.openWindow('../../seller/contract/contractdeliver.html', 'seller_contract_contractdeliver.html', {\r\n        extras: {\r\n            'contractInfo': contractInfo\r\n        }\r\n    });\r\n};\r\n\r\nexport default {\r\n    setContractPrice,\r\n    lookContractLogistics,\r\n    evaluateContract,\r\n    payContract,\r\n    cancelContract,\r\n    deliverContract\n};\n"]}