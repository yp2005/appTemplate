{"version":3,"sources":["src\\static\\js\\mui.imageViewer.js"],"names":["$","document","init","gestureConfig","tap","doubletap","longtap","swipe","drag","hold","release","touchSupport","tapEventName","enterEventName","imageClassName","className","dom","str","__create_dom_div__","createElement","innerHTML","childNodes","ImageViewer","Class","extend","selector","options","self","dbl","findAllImage","createViewer","bindEvent","viewer","closeButton","querySelector","state","leftButton","rightButton","mask","body","appendChild","images","slice","call","checkImage","target","tagName","some","image","addEventListener","event","style","display","setTimeout","opacity","index","indexOf","currentItem","createImage","disposeImage","preventDefault","cancelBubble","prev","next","EVENT_MOVE","scaleValue","EVENT_START","touches","length","p1","p2","x","pageX","y","pageY","scaleStart","Math","sqrt","isMultiTouch","dragStart","img","changedTouches","scaleEnd","_scaleValue","webkitTransform","dragEnd","_dragX","dragX","_dragY","dragY","marginLeft","marginTop","EVENT_END","__tap_num","newItem","classList","remove","add","oldItem","all","sel","willdisposes","each","i","item","parentNode","removeChild","type","src","innerText","imageViewer","ready","mui"],"mappings":"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","file":"mui.imageViewer.js","sourceRoot":"C:/Users/dell/AppData/Roaming/HBuilder/userprofiles/18710095921@163.com/appTemplate/unpackage","sourcesContent":["/**\n * 图片预览组件\n * varstion 0.4.0\n * by Houfeng\n * Houfeng@DCloud.io\n */\n\n(function($, document) {\n\n\t$.init({\n\t\tgestureConfig: {\n\t\t\ttap: true, //默认为true\n\t\t\tdoubletap: true, //默认为false\n\t\t\tlongtap: true, //默认为false\n\t\t\tswipe: true, //默认为true\n\t\t\tdrag: true, //默认为true\n\t\t\thold: true, //默认为false，不监听\n\t\t\trelease: true //默认为false，不监听\n\t\t}\n\t});\n\n\tvar touchSupport = ('ontouchstart' in document);\n\tvar tapEventName = touchSupport ? 'tap' : 'click';\n\tvar enterEventName = touchSupport ? 'tap' : 'click';\n\tvar imageClassName = $.className('image');\n\n\n\t//创建DOM (此函数是否可放在 mui.js 中)\n\t$.dom = function(str) {\n\t\tif (!$.__create_dom_div__) {\n\t\t\t$.__create_dom_div__ = document.createElement('div');\n\t\t}\n\t\t$.__create_dom_div__.innerHTML = str;\n\t\treturn $.__create_dom_div__.childNodes;\n\t};\n\n\t//图片预览组件类\n\tvar ImageViewer = $.ImageViewer = $.Class.extend({\n\t\t//构造函数\n\t\tinit: function(selector, options) {\n\t\t\tvar self = this;\n\t\t\tself.options = options || {};\n\t\t\tself.selector = selector || 'img';\n\t\t\tif (self.options.dbl) {\n\t\t\t\tenterEventName = touchSupport ? 'doubletap' : 'dblclick';\n\t\t\t}\n\t\t\tself.findAllImage();\n\t\t\tself.createViewer();\n\t\t\tself.bindEvent();\n\t\t},\n\t\t//创建图片预览组件的整体 UI\n\t\tcreateViewer: function() {\n\t\t\tvar self = this;\n\t\t\tself.viewer = $.dom(\"<div class='mui-imageviewer'><div class='mui-imageviewer-mask'></div><div class='mui-imageviewer-header'><i class='mui-icon mui-icon-closeempty mui-imageviewer-close'></i><span class='mui-imageviewer-state'></span></div><i class='mui-icon mui-icon-arrowleft  mui-imageviewer-left'></i><i class='mui-icon mui-icon-arrowright mui-imageviewer-right'></i></div>\");\n\t\t\tself.viewer = self.viewer[0] || self.viewer;\n\t\t\t//self.viewer.style.height = screen.height;\n\t\t\tself.closeButton = self.viewer.querySelector('.mui-imageviewer-close');\n\t\t\tself.state = self.viewer.querySelector('.mui-imageviewer-state');\n\t\t\tself.leftButton = self.viewer.querySelector('.mui-imageviewer-left');\n\t\t\tself.rightButton = self.viewer.querySelector('.mui-imageviewer-right');\n\t\t\tself.mask = self.viewer.querySelector('.mui-imageviewer-mask');\n\t\t\tdocument.body.appendChild(self.viewer);\n\t\t},\n\t\t//查找所有符合的图片\n\t\tfindAllImage: function() {\n\t\t\tvar self = this;\n\t\t\tself.images = [].slice.call($(self.selector));\n\t\t},\n\t\t//检查图片是否为启动预览的图片\n\t\tcheckImage: function(target) {\n\t\t\tvar self = this;\n\t\t\tif (target.tagName !== 'IMG') return false;\n\t\t\treturn self.images.some(function(image) {\n\t\t\t\treturn image == target;\n\t\t\t});\n\t\t},\n\t\t//绑定事件\n\t\tbindEvent: function() {\n\t\t\tvar self = this;\n\t\t\t//绑定图片 tap 事件\n\t\t\tdocument.addEventListener(enterEventName, function(event) {\n\t\t\t\tif (!self.viewer) return;\n\t\t\t\tvar target = event.target;\n\t\t\t\tif (!self.checkImage(target)) return;\n\t\t\t\tself.viewer.style.display = 'block';\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tself.viewer.style.opacity = 1;\n\t\t\t\t}, 0);\n\t\t\t\tself.index = self.images.indexOf(target);\n\t\t\t\tself.currentItem = self.createImage(self.index);\n\t\t\t}, false);\n\t\t\t//关系按钮事件\n\t\t\tself.closeButton.addEventListener(tapEventName, function(event) {\n\t\t\t\tself.viewer.style.opacity = 0;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tself.viewer.style.display = 'none';\n\t\t\t\t\tself.disposeImage(true);\n\t\t\t\t}, 600);\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.cancelBubble = true;\n\t\t\t}, false);\n\t\t\t//处理左右按钮\n\t\t\tself.leftButton.addEventListener(tapEventName, function() {\n\t\t\t\tself.prev();\n\t\t\t}, false);\n\t\t\tself.rightButton.addEventListener(tapEventName, function() {\n\t\t\t\tself.next();\n\t\t\t}, false);\n\t\t\t//处理划动\n\t\t\tself.mask.addEventListener($.EVENT_MOVE, function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.cancelBubble = true;\n\t\t\t}, false);\n\t\t\tself.viewer.addEventListener('swipeleft', function(event) {\n\t\t\t\tif (self.scaleValue == 1) self.next();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.cancelBubble = true;\n\t\t\t}, false);\n\t\t\tself.viewer.addEventListener('swiperight', function(event) {\n\t\t\t\tif (self.scaleValue == 1) self.prev();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.cancelBubble = true;\n\t\t\t}, false);\n\t\t\t//处理缩放开始\n\t\t\tself.viewer.addEventListener($.EVENT_START, function(event) {\n\t\t\t\tvar touches = event.touches;\n\t\t\t\tif (touches.length == 2) {\n\t\t\t\t\tvar p1 = touches[0];\n\t\t\t\t\tvar p2 = touches[1];\n\t\t\t\t\tvar x = p1.pageX - p2.pageX; //x1-x2\n\t\t\t\t\tvar y = p1.pageY - p2.pageY; //y1-y2\n\t\t\t\t\tself.scaleStart = Math.sqrt(x * x + y * y);\n\t\t\t\t\tself.isMultiTouch = true;\n\t\t\t\t} else if (touches.length = 1) {\n\t\t\t\t\tself.dragStart = touches[0];\n\t\t\t\t}\n\t\t\t}, false);\n\t\t\tself.viewer.addEventListener($.EVENT_MOVE, function(event) {\n\t\t\t\tvar img = self.currentItem.querySelector('img');\n\t\t\t\tvar touches = event.changedTouches;\n\t\t\t\tif (touches.length == 2) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.cancelBubble = true;\n\t\t\t\t\tvar p1 = touches[0];\n\t\t\t\t\tvar p2 = touches[1];\n\t\t\t\t\tvar x = p1.pageX - p2.pageX;\n\t\t\t\t\tvar y = p1.pageY - p2.pageY;\n\t\t\t\t\tself.scaleEnd = Math.sqrt(x * x + y * y);\n\t\t\t\t\tself._scaleValue = (self.scaleValue * (self.scaleEnd / self.scaleStart));\n\t\t\t\t\t//self.state.innerText = self._scaleValue;\n\t\t\t\t\timg.style.webkitTransform = \"scale(\" + self._scaleValue + \",\" + self._scaleValue + \") \"; // + \" translate(\" + self.dragX || 0 + \"px,\" + self.dragY || 0 + \"px)\";\n\t\t\t\t} else if (!self.isMultiTouch && touches.length == 1 && self.scaleValue != 1) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.cancelBubble = true;\n\t\t\t\t\tself.dragEnd = touches[0];\n\t\t\t\t\tself._dragX = self.dragX + (self.dragEnd.pageX - self.dragStart.pageX);\n\t\t\t\t\tself._dragY = self.dragY + (self.dragEnd.pageY - self.dragStart.pageY);\n\t\t\t\t\timg.style.marginLeft = self._dragX + 'px';\n\t\t\t\t\timg.style.marginTop = self._dragY + 'px';\n\t\t\t\t\t//img.style.transform = \"translate(\" + self._dragX + \"px,\" + self._dragY + \"px) \" + \" scale(\" + self.scaleValue || 1 + \",\" + self.scaleValue || 1 + \")\";\n\t\t\t\t}\n\t\t\t}, false);\n\t\t\tself.viewer.addEventListener($.EVENT_END, function() {\n\t\t\t\tself.scaleValue = self._scaleValue || self.scaleValue;\n\t\t\t\tself._scaleValue = null;\n\t\t\t\tself.dragX = self._dragX;\n\t\t\t\tself.dragY = self._dragY;\n\t\t\t\tself._dragX = null;\n\t\t\t\tself._dragY = null;\n\t\t\t\tvar touches = event.touches;\n\t\t\t\tself.isMultiTouch = (touches.length != 0);\n\t\t\t});\n\t\t\t// doubletap 好像不能用\n\t\t\tself.viewer.addEventListener('doubletap', function() {\n\t\t\t\tvar img = self.currentItem.querySelector('img');\n\t\t\t\tif (self.scaleValue === 1) {\n\t\t\t\t\tself.scaleValue = 2;\n\t\t\t\t} else {\n\t\t\t\t\tself.scaleValue = 1;\n\t\t\t\t}\n\t\t\t\tself.dragX = 0;\n\t\t\t\tself.dragY = 0;\n\t\t\t\timg.style.marginLeft = self.dragX + 'px';\n\t\t\t\timg.style.marginTop = self.dragY + 'px';\n\t\t\t\timg.style.webkitTransform = \"scale(\" + self.scaleValue + \",\" + self.scaleValue + \") \"; //+ \" translate(\" + self.dragX || 0 + \"px,\" + self.dragY || 0 + \"px)\";\n\t\t\t\tself.viewer.__tap_num = 0;\n\t\t\t}, false);\n\t\t\t//处理缩放结束\n\t\t},\n\t\t//下一张图片\n\t\tnext: function() {\n\t\t\tvar self = this;\n\t\t\tself.mask.style.display = 'block';\n\t\t\tself.index++;\n\t\t\tvar newItem = self.createImage(self.index, 'right');\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.currentItem.classList.remove('mui-imageviewer-item-center');\n\t\t\t\tself.currentItem.classList.add('mui-imageviewer-item-left');\n\t\t\t\tnewItem.classList.remove('mui-imageviewer-item-right');\n\t\t\t\tnewItem.classList.add('mui-imageviewer-item-center');\n\t\t\t\tself.oldItem = self.currentItem;\n\t\t\t\tself.currentItem = newItem;\n\t\t\t\t// TODO: 临时,稍候将调整\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tself.disposeImage();\n\t\t\t\t\tself.mask.style.display = 'none';\n\t\t\t\t}, 600);\n\t\t\t}, 25);\n\t\t},\n\t\t//上一张图片\n\t\tprev: function() {\n\t\t\tvar self = this;\n\t\t\tself.mask.style.display = 'block';\n\t\t\tself.index--;\n\t\t\tvar newItem = self.createImage(self.index, 'left');\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.currentItem.classList.remove('mui-imageviewer-item-center');\n\t\t\t\tself.currentItem.classList.add('mui-imageviewer-item-right');\n\t\t\t\tnewItem.classList.remove('mui-imageviewer-item-left');\n\t\t\t\tnewItem.classList.add('mui-imageviewer-item-center');\n\t\t\t\tself.oldItem = self.currentItem;\n\t\t\t\tself.currentItem = newItem;\n\t\t\t\t// TODO: 临时,稍候将调整\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tself.disposeImage();\n\t\t\t\t\tself.mask.style.display = 'none';\n\t\t\t\t}, 600);\n\t\t\t}, 25);\n\t\t},\n\t\t//释放不显示的图片\n\t\tdisposeImage: function(all) {\n\t\t\tvar sel = '.mui-imageviewer-item-left,.mui-imageviewer-item-right';\n\t\t\tif (all) sel += \",.mui-imageviewer-item\";\n\t\t\tvar willdisposes = $(sel);\n\t\t\twilldisposes.each(function(i, item) {\n\t\t\t\tif (item.parentNode && item.parentNode.removeChild)\n\t\t\t\t\titem.parentNode.removeChild(item, true);\n\t\t\t});\n\t\t},\n\t\t//创建一个图片\n\t\tcreateImage: function(index, type) {\n\t\t\tvar self = this;\n\t\t\ttype = type || 'center';\n\t\t\tif (index < 0) index = self.images.length - 1;\n\t\t\tif (index > self.images.length - 1) index = 0;\n\t\t\tself.index = index;\n\t\t\tvar item = $.dom(\"<div class='mui-imageviewer-item'></div>\")[0];\n\t\t\titem.appendChild($.dom('<span><img src=\"' + self.images[self.index].src + '\"/></span>')[0]);\n\t\t\titem.classList.add('mui-imageviewer-item-' + type);\n\t\t\tself.viewer.appendChild(item);\n\t\t\tself.state.innerText = (self.index + 1) + \"/\" + self.images.length;\n\t\t\t//重置初始缩放比例\n\t\t\tself.scaleValue = 1;\n\t\t\tself.dragX = 0;\n\t\t\tself.dragY = 0;\n\t\t\treturn item;\n\t\t}\n\t});\n\n\t$.imageViewer = function(selector, options) {\n\t\treturn new ImageViewer(selector, options);\n\t};\n\n\t$.ready(function() {\n\t\t$.imageViewer('.' + imageClassName);\n\t});\n\n}(mui, document));"]}